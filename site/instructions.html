
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
      <link rel="icon" href="images/favicon.png">
      <meta name="generator" content="mkdocs-1.2.1, mkdocs-material-7.1.9">
    
    
      
        <title>Instructions - STMonitor</title>
      
    
    
      <link rel="stylesheet" href="assets/stylesheets/main.ca7ac06f.min.css">
      
        
        <link rel="stylesheet" href="assets/stylesheets/palette.f1a3b89f.min.css">
        
          
          
          <meta name="theme-color" content="#ffffff">
        
      
    
    
    
      
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Nunito+Sans:300,400,400i,700%7CFira+Code&display=fallback">
        <style>:root{--md-text-font-family:"Nunito Sans";--md-code-font-family:"Fira Code"}</style>
      
    
    
    
      <link rel="stylesheet" href="stylesheets/extra.css">
    
    
      


    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="white" data-md-color-accent="">
  
    
    <script>function __prefix(e){return new URL(".",location).pathname+"."+e}function __get(e,t=localStorage){return JSON.parse(t.getItem(__prefix(e)))}</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#instructions" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="index.html" title="STMonitor" class="md-header__button md-logo" aria-label="STMonitor" data-md-component="logo">
      
  <img src="images/logo2.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            STMonitor
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Instructions
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" data-md-state="active" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        
<a href="https://github.com/chrisbartoloburlo/stmonitor/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    chrisbartoloburlo/stmonitor
  </div>
</a>
      </div>
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  

<nav class="md-nav md-nav--primary md-nav--integrated" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="index.html" title="STMonitor" class="md-nav__button md-logo" aria-label="STMonitor" data-md-component="logo">
      
  <img src="images/logo2.png" alt="logo">

    </a>
    STMonitor
  </label>
  
    <div class="md-nav__source">
      
<a href="https://github.com/chrisbartoloburlo/stmonitor/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    chrisbartoloburlo/stmonitor
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="index.html" class="md-nav__link">
        About
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Instructions
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="instructions.html" class="md-nav__link md-nav__link--active">
        Instructions
      </a>
      
        
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#requirements" class="md-nav__link">
    Requirements
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#synthesising-a-monitor" class="md-nav__link">
    Synthesising a Monitor
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#examples" class="md-nav__link">
    Examples
  </a>
  
    <nav class="md-nav" aria-label="Examples">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#authentication-protocol" class="md-nav__link">
    Authentication protocol
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#guessing-game" class="md-nav__link">
    Guessing game
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#calculator" class="md-nav__link">
    Calculator
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#benchmarks" class="md-nav__link">
    Benchmarks
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/chrisbartoloburlo/stmonitor/edit/master/docs/instructions.md" title="Edit this page" class="md-content__button md-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"/></svg>
                  </a>
                
                
                <h1 id="instructions">Instructions<a class="headerlink" href="#instructions" title="Permanent link">&para;</a></h1>
<h2 id="requirements">Requirements<a class="headerlink" href="#requirements" title="Permanent link">&para;</a></h2>
<ul>
<li>Java SE Development Kit (recommended: version 11 LTS)</li>
<li><a href="https://www.scala-sbt.org/download.html"><code>sbt</code></a> 1.5.0</li>
</ul>
<p>To compile, execute the command <code>sbt compile</code> from the root directory.</p>
<p>Here we explain how to:</p>
<ol>
<li><a href="#synthesising-a-monitor">invoke the monitor synthesis tool</a></li>
<li><a href="#examples">run the examples</a></li>
<li><a href="#benchmarks">run the benchmarks</a></li>
</ol>
<h2 id="synthesising-a-monitor">Synthesising a Monitor<a class="headerlink" href="#synthesising-a-monitor" title="Permanent link">&para;</a></h2>
<p>Our tool generates session type monitors consisting of two main components: the monitoring logic, and the <em>Continuation Passing-Style Protocol classes</em> (CPSP classes) that describe the type and ordering of the messages being sent and received.</p>
<p>To generate the monitor code and the CPSP classes, run the following command:</p>
<pre><code class="language-shell">sbt &quot;project monitor&quot; &quot;runMain monitor.Generate $DIR $ST $PREAMBLE&quot;
</code></pre>
<p>Where:</p>
<ul>
<li><code>$DIR</code> is the directory where the source code of the monitor and classes will be generated</li>
<li><code>$ST</code> is the file containing the session type, and</li>
<li><code>$PREAMBLE</code> <em>(optional)</em> is a file containing a preamble that will be added to the top of the generated files (typically containing package declarations and imports, as in <a href="examples/src/main/scala/examples/http/preamble.txt">this file</a>).</li>
</ul>
<p>Once completed, the autogenerated files <code>Monitor.scala</code> and <code>CPSPc.scala</code> will be present in the directory <code>$DIR</code>. </p>
<p>The type session type <code>$ST</code> can use boolean Scala functions as assertions, to perform run-time checks on the values being transmitted or received. If this feature is used, the monitor synthesiser expects that:</p>
<ol>
<li>all assertion functions begin with <code>util...</code> (for example: <code>util.assertNonNegative(x)</code>), and</li>
<li>all assertion functions are defined in a file named <code>util.scala</code> located in the directory <code>$DIR</code> provided to the synthesiser.</li>
</ol>
<p>The synthesiser type-checks the assertion functions (through the Scala <a href="https://www.scala-lang.org/api/2.12.3/scala-compiler/scala/tools/reflect/ToolBox.html"><code>ToolBox</code></a> API), and ensures that they have a <code>Boolean</code> return type. </p>
<h2 id="examples">Examples<a class="headerlink" href="#examples" title="Permanent link">&para;</a></h2>
<p>The source code of all examples is available under the <a href="examples/src/main/scala/examples/"><code>examples/</code></a> directory.</p>
<p>Here we discuss two examples: the <a href="#authentication-protocol">authentication protocol</a> in the ECOOP'21 paper, and a <a href="#guessing-game">guessing game</a>.</p>
<p>We also discuss an (incomplete) <a href="#calculator">calculator example</a> to observe how the monitor generation output varies depending on the input session type.</p>
<p><strong>Notes:</strong></p>
<ul>
<li>
<p>Some links below point to autogenerated monitor files (not present on the GitHub repository). Before continuing, you may want create such files by running:
  <code>shell
  sbt examples/compile</code></p>
</li>
<li>
<p><a href="https://www.python.org/downloads/"><code>Python 3</code></a> is required to run some components of the following examples.</p>
</li>
</ul>
<h3 id="authentication-protocol">Authentication protocol<a class="headerlink" href="#authentication-protocol" title="Permanent link">&para;</a></h3>
<p>These instructions describe how to execute an extended version of the running example in the ECOOP 2021 paper (in particular, Section 5.2): the authentication protocol.</p>
<p>The protocol is formalised as the session type <code>S_auth</code> below, as found in the file <a href="examples/src/main/scala/examples/auth/auth.st"><code>auth.st</code></a>:</p>
<pre><code>S_auth = rec Y.(!Auth(uname: String, pwd: String)[util.validateUname(uname)].&amp;{
    ?Succ(origTok: String)[util.validateTok(origTok, uname)].rec X.(+{
        !Get(resource: String, reqTok: String).&amp;{
            ?Res(content: String)[origTok==reqTok].X,
            ?Timeout().Y
        },
        !Rvk(rvkTok: String)[origTok==rvkTok].end}),
    ?Fail(code: Int).end
})
</code></pre>
<p>The protocol begins with the client sending an <code>Auth</code>entication request to the server.
If the authentication is <code>Succ</code>essful, the client is given a token <code>origTok</code>, and is allowed to request resources by sending a <code>Get</code> message. The token might expire after a while, hence the server might either:
  * provide the requested <code>Res</code>ource and allow for more <code>Get</code> requests (through the recursion on <code>X</code>), or
  * answer <code>Timeout</code>, letting the client re-authenticate and obtain another token (through the recursion on <code>Y</code>).
The client can also revoke the token (by sending the message <code>Rvk</code>), which ends the session.</p>
<p>The session type above specifies various predicates that the synthetised monitor checks at run-time:
  * the username sent by the client is validated using the function <code>util.validateUname()</code>
  * the token <code>origTok</code> issued upon successful authentication is validated using the function <code>util.validateTok()</code>
  * whenever the server sends a <code>Res</code>ource, the token included in the <code>Get</code> message (<code>reqTok</code>) must be equal to the token issued in the previous <code>Succ</code> message(<code>origTok</code>)
  * whenever the message <code>Rvk</code> is sent, its token <code>rvkTok</code> must be the same as <code>origTok</code>.</p>
<p>The functions <code>util.validateUname()</code> and <code>util.validateTok()</code> can be found in the file <a href="examples/src/main/scala/examples/auth/util.scala"><code>util.scala</code></a>. For the sake of the example, their implementations always return <code>true</code>; you can change their return value to <code>false</code> and observe that the monitor indeed flags assertion violations.</p>
<p>The synthesised monitor <a href="examples/src/main/scala/examples/auth/Monitor.scala"><code>Monitor.scala</code></a> and CPSP classes <a href="examples/src/main/scala/examples/auth/CPSPc.scala"><code>CPSPc.scala</code></a> are generated automatically from the file <a href="examples/src/main/scala/examples/auth/auth.st"><code>auth.st</code></a>, every time the example is compiled or executed via <code>sbt</code>.</p>
<p>We provide the implementation of two different client-server setups that use the autogenerated monitor.</p>
<h4 id="setup-1-untrusted-client-trusted-server-written-in-scalalchannels">Setup 1: untrusted client, trusted server written in Scala+lchannels<a class="headerlink" href="#setup-1-untrusted-client-trusted-server-written-in-scalalchannels" title="Permanent link">&para;</a></h4>
<p>The synthesised monitor (<a href="examples/src/main/scala/examples/auth/Monitor.scala"><code>Monitor.scala</code></a>) verifies the interaction between an untrusted client and a trusted server (<a href="examples/src/main/scala/examples/auth/Server.scala"><code>Server.scala</code></a>) implemented in Scala using the <code>lchannels</code> library.</p>
<p>In this setup the monitor makes use of a <a href="examples/src/main/scala/examples/auth/ConnectionManager.scala">connection manager</a>, which sits between the untrusted client and the monitor: its purpose is to translate messages from a text-based protocol to the types present in the generated <a href="examples/src/main/scala/examples/auth/CPSPc.scala"><code>CPSPc.scala</code></a> file, and vice-versa.</p>
<p>Since the generated monitor uses <code>lchannels</code> to interact with the trusted side, we in this setup run the monitor and server on the same JVM (as separate threads), and let them interact through a fast local message transport (i.e., via <code>LocalChannel</code>s provided by <code>lchannels</code>).</p>
<ol>
<li>
<p>Start the server together with the monitor using the following command:
    <code>shell
    sbt "project examples" "runMain examples.auth.MonitoredServer"</code></p>
</li>
<li>
<p>In a separate terminal, start an untrusted client (a Python script) which connects to the server (with the monitor in between) and sends multiple requests:
   <code>python3 scripts/auth-client.py</code></p>
</li>
</ol>
<p>The Python script above will print the sent/received messages on screen. You can also interact with the monitored server manually, by executing, e.g.:</p>
<pre><code class="language-shell">netcat 127.0.0.1 1330
</code></pre>
<p>By altering the messages sent to the server, you can observe the monitor flag violations and close the ongoing session. You can try, e.g., sending wrong messages (such as <code>AUTHXXX</code> instead of <code>AUTH</code>), or invalid tokens.</p>
<h4 id="setup-2-untrusted-client-trusted-server-written-in-python">Setup 2: untrusted client, trusted server written in Python<a class="headerlink" href="#setup-2-untrusted-client-trusted-server-written-in-python" title="Permanent link">&para;</a></h4>
<p>In this setup, the synthesised monitor <a href="examples/src/main/scala/examples/auth/Monitor.scala"><code>Monitor.scala</code></a> (the same used in the previous setup) is used to verify the interaction between an untrusted client and a trusted server written in Python (<a href="scripts/auth-server.py"><code>auth-server.py</code></a>), hence <em>not</em> using <code>lchannels</code>.</p>
<p>In this setup the monitor makes use of <em>two</em> connection managers:</p>
<ul>
<li><a href="examples/src/main/scala/examples/auth/ConnectionManager.scala">one</a> sits between the untrusted client and the monitor (it is the same used in the previous setup);</li>
<li>
<p>the <a href="examples/src/main/scala/examples/auth/MonWrapper.scala#L12">other</a> sits between the monitor and the server, and provides a suitable message transport for the <code>lchannels</code> library. This connection manager also translates messages to/from the types found in the <a href="examples/src/main/scala/examples/auth/CPSPc.scala"><code>CPSPc.scala</code></a> file --- but it performs less run-time checks, since it is facing the trusted server.</p>
</li>
<li>
<p>Start the trusted server using the following command:
    <code>shell
    python3 scripts/auth-server.py</code></p>
</li>
<li>
<p>In a separate terminal, start the monitor:
   <code>shell
   sbt "project examples" "runMain examples.auth.MonWrapper 1330 1335"</code>
   where <code>1330</code> is the port where the monitor listens for client connections, and <code>1335</code> is the port where the trusted server is running.</p>
</li>
<li>
<p>In another terminal, start an untrusted client (a Python script):
   <code>shell
   python3 scripts/auth-client.py</code>
   The client sends/receives messages via port 1330, which is handled by the monitor. In turn, the monitor analyses and forwards the messages to the server, and forwards its responses to the client. </p>
</li>
</ul>
<h3 id="guessing-game">Guessing game<a class="headerlink" href="#guessing-game" title="Permanent link">&para;</a></h3>
<p>The type <code>S_game</code> below can be found in <a href="examples/src/main/scala/examples/game/game.st"><code>game.st</code></a>. In this case, the type describes the protocol from the server side.</p>
<pre><code>S_game = rec X.(&amp;{
  ?Guess(num: Int)[num &gt; 1 &amp;&amp; num &lt; 100].+{
        !Correct(ans: Int)[ans==num],
        !Incorrect().X
    },
    ?Quit()
})
</code></pre>
<p>The server waits for the client to either <code>Quit</code>, or send a <code>Guess</code> message carrying a <code>num</code>ber; the assertion checks that <code>num</code> is between 1 and 100. The server can answer <code>Correct</code> (carryng the same number guessed by the client) or <code>Incorrect</code> --- and in this case, the session repeats from the start (by looping on <code>X</code>).</p>
<p>We provide the implementation of a <a href="examples/src/main/scala/examples/game/MonitoredClient.scala">client written in Scala</a>, and a <a href="scripts/game-server.py">server written in Python</a>. </p>
<ol>
<li>
<p>To start the server, execute: 
   <code>shell
   python3 scripts/game-server.py</code>
   When a client connects, the server generates a random number between 1 and 100. The client can recursively send guesses and if it guesses the number, the server replies with <code>Correct</code> and terminates the session. Otherwise, the server replies with <code>Incorrect</code> and the session recurses, giving the client another chance to guess correctly.</p>
</li>
<li>
<p>In a separate terminal, you can launch a <a href="examples/src/main/scala/examples/game/MonitoredClient.scala"><code>client</code></a> that also spawns the <a href="examples/src/main/scala/examples/game/Monitor.scala">monitor synthesised from <code>S_game</code></a> (as a separate thread), by executing:
   <code>shell
   sbt "project examples" "runMain examples.game.MonitoredClient"</code>
   The monitored client connects to the server on the port 1330, and asks the user to input a guess which is sent to the server. The client iterates until the server replies with <code>Correct</code>, or the user quits. To test that the monitor flags a violation and terminates the session, you can try providing a number smaller than 1 or greater than 100. </p>
</li>
</ol>
<h3 id="calculator">Calculator<a class="headerlink" href="#calculator" title="Permanent link">&para;</a></h3>
<p>This example shows how to experiment with the monitor synthesis. Unlike the previous examples, here we do not provide an implementation of a client or server using the generated monitor.</p>
<p>The session type <code>S_calc</code> below (taken from <a href="examples/src/main/scala/examples/calc/calc.st"><code>calc.st</code></a>) describes a simple calculator, that (recursively) lets user ask to <code>Add</code> two numbers, and answers with their sum.</p>
<pre><code>S_calc = rec X.(&amp;{?Add(num1: Int, num2: Int).!Res(ans: Int)[util.checkAdd(num1, num2, ans)]})
</code></pre>
<p>To generate the monitor and CPSP classes from this session type, execute the following command:</p>
<pre><code class="language-shell">sbt &quot;project monitor&quot; &quot;runMain monitor.Generate examples/src/main/scala/examples/calc examples/src/main/scala/examples/calc/calc.st examples/src/main/scala/examples/calc/preamble.txt&quot;
</code></pre>
<p>The generated monitor uses a <a href="examples/src/main/scala/examples/calc/preamble.txt"><code>preamble</code></a> and the file <a href="examples/src/main/scala/examples/calc/util.scala"><code>util.scala</code></a> plementing the function <code>util.checkAdd()</code>, where the assertion function <code>util.checkAdd</code> is defined.</p>
<p>If successful, the monitor synthesis produces the following output:</p>
<pre><code>INFO Synth - Input type calc.st parsed successfully
INFO Synth - Successful synthesis for input type calc.st at stmonitor/examples/src/main/scala/examples/calc
</code></pre>
<p>The generated files are <a href="examples/src/main/scala/examples/calc/Monitor.scala"><code>Monitor.scala</code></a> and <a href="examples/src/main/scala/examples/calc/CPSPc.scala"><code>CPSPc.scala</code></a>.</p>
<p>We encourage the reader to extend the session type <code>S_calc</code>, re-execute the monitor synthesis, and observe the changes in the generated code.
For example, this variation of the type adds the option to perform a subtraction, and checks that the result is correct:</p>
<pre><code>S_calc = rec X.(&amp;{
    ?Add(num1: Int, num2: Int).!Res(ans: Int)[util.checkAdd(num1, num2, ans)],
    ?Sub(num1: Int, num2: Int).!Res(ans: Int)[ans==num2-num1]
})
</code></pre>
<h2 id="benchmarks">Benchmarks<a class="headerlink" href="#benchmarks" title="Permanent link">&para;</a></h2>
<p>The source code of all benchmarks is available under the <a href="examples/src/main/scala/examples/"><code>examples/</code></a> directory.</p>
<p>The benchmarks can <em>only</em> be executed on Linux, or other Unix-like systems providing a <code>/usr/bin/time</code> utility compatible with <a href="https://www.gnu.org/software/time/">GNU Time</a> --- which we use for observing CPU usage and memory consumption.</p>
<p>The following dependencies are also required:
* <a href="https://www.gnu.org/software/screen/">GNU screen</a>
* Python 3 and <a href="https://matplotlib.org/">Matplotlib</a>
* <a href="https://jmeter.apache.org">JMeter</a></p>
<p>To execute a <em>kick-the-tires</em> version of the benchmarks (taking around 5 minutes), you can run:</p>
<pre><code class="language-shell">sh scripts/benchmarks.sh kickthetires
</code></pre>
<p>When it finishes, the benchmarking script above prints the directories containing the generated plots (in PDF format). If such PDF files are available, then the full benchmarks below should work without issues (note, however, that the generated kick-the-tires PDFs are not very informative).</p>
<p>To run the <em>full</em> benchmarks, and generate complete plots, you can execute:</p>
<pre><code class="language-shell">sh scripts/benchmarks.sh $REPETITIONS $EXPERIMENTS
</code></pre>
<p>where: </p>
<ul>
<li><code>$REPETITIONS</code> is the number of repetitions of each experiment:<ul>
<li>we recommend a minimum of 5 repetitions (taking around 3 hours on a virtual machine running on a dual-core Intel Core i5, 8 GB RAM, macOS 11.2.3);</li>
<li>the plots in the ECOOP'21 paper have been generated with 30 repetitions.</li>
</ul>
</li>
<li><code>$EXPERIMENTS</code> is a space-separated list of the experiments to run. The choices are one or more of: <ul>
<li><code>smtp-python</code>: a trusted client sends a number of emails to an untrusted SMTP server, implemented using <a href="https://docs.python.org/3/library/smtpd.html"><code>smtpd</code></a> from the Python standard library.  The monitor for this experiment is generated from a fragment of the SMTP protocol, formalised as a session type. Some relevant files for this benchmark are:<ul>
<li><a href="examples/src/main/scala/examples/smtp/smtp.st"><code>smtp.st</code></a>: session type with SMTP protocol fragment</li>
<li><a href="examples/src/main/scala/examples/smtp/Monitor.scala"><code>Monitor.scala</code></a> and <a href="examples/src/main/scala/examples/smtp/CPSPc.scala"><code>CPSPc.scala</code></a>: files generated from the session type above</li>
</ul>
</li>
<li><code>smtp-postfix</code>: analogous to the previous experiment, except that it uses an untrusted SMTP server listening on port <code>127.0.0.1:25</code>.  The plots of the ECOOP'21 paper are genarated using the <a href="http://www.postfix.org">Postfix</a> SMTP server;</li>
<li><code>pingpong</code>: a trusted server accepts 'ping' requests over HTTP, and answers 'pong'. The untrusted client is JMeter, configured to send an increasing number of requests and measure the server performance. Some relevant files for this benchmark are:<ul>
<li><a href="examples/src/main/scala/examples/pingpong/pingpong.st"><code>pingpong.st</code></a>: session type for ping-pong protocol</li>
<li><a href="examples/src/main/scala/examples/pingpong/Monitor.scala"><code>Monitor.scala</code></a> and <a href="examples/src/main/scala/examples/pingpong/CPSPc.scala"><code>CPSPc.scala</code></a>: files generated from the session type above</li>
</ul>
</li>
<li><code>http</code>: a trusted web server implements a fragment of the HTTP protocol, formalised as the session type. The untrusted client is JMeter, configured to send an increasing number of requests and measure the server performance. Some relevant files for this benchmark are:<ul>
<li><a href="examples/src/main/scala/examples/http/http.st"><code>http.st</code></a>: session type with HTTP protocol</li>
<li><a href="examples/src/main/scala/examples/http/Monitor.scala"><code>Monitor.scala</code></a> and <a href="examples/src/main/scala/examples/http/CPSPc.scala"><code>CPSPc.scala</code></a>: files generated from the session type above</li>
<li><a href="examples/src/main/scala/examples/http/Worker.scala"><code>Worker.scala</code></a>: core of the trusted web server, derived from the <a href="https://github.com/alcestes/lchannels/tree/master/examples/src/main/scala/lchannels/examples/http"><code>lchannels</code> HTTP server</a>.</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>When it finishes, the benchmarking script above prints the directories containing the generated plots (in PDF format).</p>
                
              
              
                


              
            </article>
          </div>
        </div>
        
      </main>
      
        
<footer class="md-footer">
  
    <nav class="md-footer__inner md-grid" aria-label="Footer">
      
        
        <a href="index.html" class="md-footer__link md-footer__link--prev" aria-label="Previous: About" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              About
            </div>
          </div>
        </a>
      
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            Copyright &copy; 2021 Christian Bartolo Burlò
          </div>
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
        
      </div>
      
  <div class="md-footer-social">
    
      
      
        
        
      
      <a href="https://twitter.com/bartoloburlo" target="_blank" rel="noopener" title="twitter.com" class="md-footer-social__link">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"/></svg>
      </a>
    
      
      
        
        
      
      <a href="https://github.com/chrisbartoloburlo" target="_blank" rel="noopener" title="github.com" class="md-footer-social__link">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
      </a>
    
  </div>

    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": ".", "features": ["navigation.indexes", "navigation.tracking", "navigation.instant", "toc.integrate"], "translations": {"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "search": "assets/javascripts/workers/search.477d984a.min.js", "version": null}</script>
    
    
      <script src="assets/javascripts/bundle.82b56eb2.min.js"></script>
      
    
  </body>
</html>